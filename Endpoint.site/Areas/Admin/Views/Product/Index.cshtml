@addTagHelper *, LazZiya.TagHelpers
@using Store_Application.Services.Product.Queries.GetProductForAdmin;
@model ProductForAdminDto;

@{
    ViewData["Title"] = "لیست محصولات";
    Layout = "~/Areas/Admin/Views/Shared/_Adminlayout.cshtml";
}


<div class="content-wrapper">
    <div class="container-fluid">
        <!-- Zero configuration table -->
        <section id="configuration">
            <div class="row">
                <div class="col-12">
                    <div class="card">

                        <div class="card-body collapse show">
                            <div class="card-block card-dashboard">
                                <p class="card-text">لیست محصولات</p>
                                <a href="~/admin/Product/Create" class="btn btn-success">افزودن محصول جدید</a>
                                <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4">
                                    <div class="col-sm-12">
                                        <table class="table table-striped table-bordered zero-configuration dataTable" id="DataTables_Table_0" role="grid" aria-describedby="DataTables_Table_0_info">
                                            <thead>
                                                <tr role="row">
                                                    <th class="sorting_asc">نام</th>
                                                    <th class="sorting_asc">دسته بندی</th>
                                                    <th class="sorting_asc">برند </th>
                                                    <th class="sorting_asc">قیمت </th>
                                                    <th class="sorting_asc">موجودی </th>
                                                    <th class="sorting_asc">نمایش در سایت؟ </th>
                                                    <th class="sorting_asc">تصویر </th>
                                                    <th class="sorting_asc"> </th>
                                                </tr>
                                            </thead>
                                            <tbody>

                                                @foreach (var item in Model.Products)
                                                {
                                                    
                                                    <tr role="row">
                                                        <td>@item.Name</td>
                                                        <td>@item.Category</td>
                                                        <td>@item.Brand</td>
                                                        <td>@item.Price.ToString("n0")</td>
                                                        <td>@item.Inventory</td>
                                                        <td>@item.Displayed</td>
                                                        <td>
                                                            <img src="~/@item.Images.ToList().FirstOrDefault()" width="60" height="50" />
                                                        </td>
                                                        <td>
                                                            <button class="btn btn-danger" onclick="Delete('@item.Id')">حذف</button>
                                                        </td>
                                                        <td>
                                                            <a href="~/admin/Product/Detail/@item.Id" class="btn btn-info">اطلاعات بیشتر</a>
                                                        </td>
                                                        <td>
                                                        @*    <a onclick="ShowModalEdit('@item.Id' , '@item.Name', '@item.Brand', '@item.Category'
                                                            , '@item.Description', '@item.Displayed', '@item.Inventory', '@item.Price')" class="btn btn-success text-white">ویرایش </a>*@
                                                          @*  <a onclick="ShowModalEdit('@item.Id' , '@item.Name', '@item.Brand', '@item.Category'
                                                            , '@item.Description', '@item.Displayed', '@item.Inventory', '@item.Price'
                                                            ,'@item.Images','@item.Features')" class="btn btn-success text-white">ویرایش </a>*@
                                                             <a href="~/admin/Product/Edit/@item.Id" class="btn btn-success">ویرایش </a>
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="text-center">
                                    <paging total-records="Model.RowCount"
                                            page-no="Model.CurrentPage"
                                            page-size="Model.PageSize"
                                            show-prev-next="true"
                                            show-total-pages="false"
                                            show-total-records="false"
                                            show-page-size-nav="true"
                                            show-first-numbered-page="true"
                                            show-last-numbered-page="true"
                                            query-string-key-page-no="Page"
                                            query-string-key-page-size="PageSize"
                                            gap-size="2">
                                    </paging>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>

@section Scripts
    {

    <link href="~/Sweetalert2/sweetalert2.min.css" rel="stylesheet" />
    <script src="~/Sweetalert2/sweetalert2.min.js"></script>

    <script>


        function Delete(Id) {
            swal.fire({
                title: 'حذف محصول',
                text: "کاربر گرامی از حذف مطمئن هستید؟",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#7cacbe',
                confirmButtonText: 'بله ، حذف شود',
                cancelButtonText: 'خیر'
            }).then((result) => {
                if (result.value) {
                    var postData = {
                        'Id': Id,
                    };

                    $.ajax({
                        contentType: 'application/x-www-form-urlencoded',
                        dataType: 'json',
                        type: "POST",
                        url: "Delete",
                        data: postData,
                        success: function (data) {
                            if (data.isSuccess == true) {
                                swal.fire(
                                    'موفق!',
                                    data.message,
                                    'success'
                                ).then(function (isConfirm) {
                                    location.reload();
                                });
                            }
                            else {

                                swal.fire(
                                    'هشدار!',
                                    data.message,
                                    'warning'
                                );

                            }
                        },
                        error: function (request, status, error) {
                            alert(request.responseText);
                        }

                    });

                }
            })
        }



        //function Edit() {

        //    var Id = $("#Edit_Id").val();
        //    var Name = $("#Edit_Name").val();
        //    var Brand = $("#Edit_Brand").val();
        //    var Category = $("#Edit_Category").val();
        //    var Description = $("#Edit_Description").val();
        //    var Displayed = $("#Edit_Displayed").val();
        //    var Inventory = $("#Edit_Inventory").val();
        //    var Price = $("#Edit_Price").val();
        //    //var Images = $("#Edit_Images").val();
        //    //var Features = $("#Edit_Features").val();

        //    var postData = {
        //        'Id': Id,
        //        'Name': Name,
        //        'Brand': Brand,
        //        'Category': Category,
        //        'Description': Description,
        //        'Displayed': Displayed,
        //        'Inventory': Inventory,
        //        'Price': Price,
        //        //'Images': Images,
        //        //'Features': Features,
        //    };


        //    $.ajax({
        //        contentType: 'application/x-www-form-urlencoded',
        //        dataType: 'json',
        //        type: "POST",
        //        url: "Edit",
        //        data: postData,
        //        success: function (data) {
        //            if (data.isSuccess == true) {
        //                swal.fire(
        //                    'موفق!',
        //                    data.message,
        //                    'success'
        //                ).then(function (isConfirm) {
        //                    location.reload();
        //                });
        //            }
        //            else {
        //                swal.fire(
        //                    'هشدار!',
        //                    data.message,
        //                    'warning'
        //                );
        //            }
        //        },
        //        error: function (request, status, error) {
        //            alert(request.responseText);
        //        }
        //    });

        //    $('#Edit').modal('hide');
        //}
        //function ShowModalEdit(Id, Name, Brand, Category, Description, Displayed, Inventory, Price, Images, Features) {
        //    $('#Edit_Name').val(Name)
        //    $('#Edit_Id').val(Id)
        //    $("#Edit_Brand").val(Brand);
        //    $("#Edit_Category").val(Category);
        //    $("#Edit_Description").val(Description);
        //    $("#Edit_Displayed").val(Displayed);
        //    $("#Edit_Inventory").val(Inventory);
        //    $("#Edit_Price").val(Price);
        //    $("#Edit_Images").val(Images);
        //    $("#Edit_Features").val(Features);

            

        //}
    </script>
        }

   @* @section Modals
    {
    <!-- Modal Edit -->
    <div class="modal fade" id="Edit" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" >
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">ویرایش محصول</h5>
                    <span style="text-align:left">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color:red;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    </span>
                </div>
                <div class="modal-body">
                    <div class="col-xl-12 col-lg-12 col-md-12 mb-1">
                        <div class="row">
                        <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                        <fieldset class="form-group">
                            <input type="hidden" id="Edit_Id" />
                            <label for="basicInput">نام محصول</label>
                            <input type="text" class="form-control" id="Edit_Name" asp-for="Edit_Name">
                        </fieldset>
                        </div>                       
                            <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                                <fieldset class="form-group">
                                    <label for="basicInput"> برند </label>
                                    <input type="text" class="form-control" id="Edit_Brand" asp-for="Edit_Brand">
                                </fieldset>
                            </div>
                            <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                                <fieldset class="form-group">
                                    <label for="basicInput"> قیمت</label>
                                    <input type="number" class="form-control" id="Edit_Price" asp-for="Edit_Price">
                                </fieldset>
                            </div>
                            <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                                <fieldset class="form-group">
                                    <label for="basicInput"> تعداد موجودی</label>
                                    <input type="number" class="form-control" id="Edit_Inventory" asp-for="Edit_Inventory">
                                </fieldset>
                            </div>
                            <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                                <fieldset class="form-group">
                                    <label for="basicInput">نمایش داده شود؟ </label>
                            
                                    <input type="checkbox" class="form-control" id="Edit_Displayed" asp-for="Edit_Displayed">
                                </fieldset>
                            </div>
                            <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                                <fieldset class="form-group">
                                    <label for="basicInput">تصاویر </label>
                                    <input type="file" multiple class="form-control" accept="image/*" id="Edit_Images" asp-for="Edit_Images">
                                </fieldset>
                            </div>


                           <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                                <fieldset class="form-group">
                                    <label for="basicInput">دسته بندی </label>

                                    <select class="form-control" id="Edit_Category" asp-items="@ViewBag.Categories" asp-for="Edit_Category"></select>
                                </fieldset>
                            </div>
                            <div class="col-xl-12 col-lg-12 col-md-12 mb-1">
                                <fieldset class="form-group">
                                    <label for="basicInput"> توضیحات</label>
                                    <textarea id="Edit_Description" class="form-control " rows="5" asp-for="Edit_Description"></textarea>
                                </fieldset>
                            </div>

                            <hr />
                            <hr />
                            <div class="col-xl-2 col-lg-3 col-md-12 mb-1">
                                <fieldset class="form-group">
                                    <label for="basicInput"> نام ویژگی </label>
                                    <input type="text" class="form-control" id="Edit_Features" placeholder="نام ویژگی" />
                                </fieldset>
                            </div>

                            <div class="col-xl-2 col-lg-3 col-md-12 mb-1">
                                <fieldset class="form-group">
                                    <label for="basicInput"> مقدار ویژگی </label>
                                    <input type="text" class="form-control" id="txtValue" placeholder="مقدار ویژگی" />
                                </fieldset>
                            </div>
                            <div class="col-xl-2 col-lg-2 col-md-12 mb-1">
                                <fieldset class="form-group">
                                    <br />
                                    <a class="btn btn-success text-white" id="btnAddFeatures">افزودن</a>
                                </fieldset>
                            </div>
                            <br class="clear" />

                            <table id="tbl_Features" class="col-md-4 table table-bordered table-hover  table-condensed table-responsive">
                                <thead>
                                  
                                    <tr>
                                        <th>
                                            نام ویژگی
                                        </th>
                                        <th>
                                            مقدار ویژگی
                                        </th>
                                        <th>

                                        </th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>                           
                        </div>
                    </div>
                    <div>
                        <a class="btn btn-primary" onclick="Edit()">اعمال تغییرات</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
}*@